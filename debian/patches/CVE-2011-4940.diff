Origin: http://hg.python.org/cpython/raw-rev/8cdb95cf096e
Description: Issue #11442: Add a charset parameter to the Content-type in
 SimpleHTTPServer to avoid XSS attacks.
Bug: http://bugs.python.org/issue11442

diff -Naurp python2.6-2.6.6/Lib/SimpleHTTPServer.py python2.6-2.6.6.new/Lib/SimpleHTTPServer.py
--- python2.6-2.6.6/Lib/SimpleHTTPServer.py	2008-07-06 16:34:39.000000000 -0500
+++ python2.6-2.6.6.new/Lib/SimpleHTTPServer.py	2012-09-28 07:18:44.000000000 -0500
@@ -15,6 +15,7 @@ import posixpath
 import BaseHTTPServer
 import urllib
 import cgi
+import sys
 import shutil
 import mimetypes
 try:
@@ -131,7 +132,8 @@ class SimpleHTTPRequestHandler(BaseHTTPS
         length = f.tell()
         f.seek(0)
         self.send_response(200)
-        self.send_header("Content-type", "text/html")
+        encoding = sys.getfilesystemencoding()
+        self.send_header("Content-type", "text/html; charset=%s" % encoding)
         self.send_header("Content-Length", str(length))
         self.end_headers()
         return f
